// AdGuard Plugin for Lampa
// GitHub: https://github.com/[username]/lampa-adguard-plugin

(function() {
    'use strict';
    
    const adGuardPlugin = {
        name: "AdGuard Blocker",
        version: "1.0",
        author: "Mikko",
        
        init: function() {
            this.blockAds();
            this.hideAdElements();
            this.interceptRequests();
        },
        
        blockAds: function() {
            // Блокировка рекламных доменов
            const adDomains = [
                'doubleclick.net',
                'googleads.com',
                'googlesyndication.com',
                'admob.com',
                'facebook.com/ads',
                'adsystem.com',
                'advertising.com'
            ];
            
            // Перехват XMLHttpRequest
            const originalXHR = window.XMLHttpRequest;
            window.XMLHttpRequest = function() {
                const xhr = new originalXHR();
                const originalOpen = xhr.open;
                
                xhr.open = function(method, url) {
                    if (adDomains.some(domain => url.includes(domain))) {
                        console.log('Ad blocked:', url);
                        return null;
                    }
                    return originalOpen.apply(this, arguments);
                };
                return xhr;
            };
        },
        
        hideAdElements: function() {
            // Поиск и скрытие рекламных элементов
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    mutation.addedNodes.forEach(function(node) {
                        if (node.nodeType === 1) {
                            // Эвристики для обнаружения рекламы
                            if (node.innerHTML.includes('ad') || 
                                node.className.includes('ad') ||
                                node.id.includes('ad')) {
                                node.style.display = 'none';
                                console.log('Ad element hidden');
                            }
                        }
                    });
                });
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        },
        
        interceptRequests: function() {
            // Перехват fetch запросов
            const originalFetch = window.fetch;
            window.fetch = function(...args) {
                const url = args[0];
                if (typeof url === 'string' && 
                    (url.includes('/ad/') || url.includes('banner'))) {
                    console.log('Ad request blocked:', url);
                    return Promise.reject(new Error('Ad blocked'));
                }
                return originalFetch.apply(this, args);
            };
        }
    };
    
    // Автоматическая инициализация при загрузке
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            adGuardPlugin.init();
        });
    } else {
        adGuardPlugin.init();
    }
    
    console.log('AdGuard Plugin for Lampa activated');
})();
